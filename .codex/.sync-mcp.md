# mcp-sync (MCP Configuration Synchronization Tool)
One-click synchronization tool for MCP configuration

## 1. 概述 (Overview)

`mcp-sync` 是一个基于 Node.js 的命令行工具，旨在解决开发人员在多个 IDE、代码编辑器和 CLI 工具之间手动同步通用配置（如代理、模型 API Key、主题等）的痛点。用户可以通过简单的命令，将一个工具的配置文件（源）安全地同步到另一个工具（目标），从而实现配置的统一和自动化管理。

## 2. 技术规格 (Technical Specifications)

- **环境**：Node.js 18+（需要 ESM 支持及现代 API）。
- **分发方式**：通过 npm 分发，支持 `npx mcp-sync` 直接执行，也可 `npm i -g mcp-sync` 全局安装。
- **运行依赖**：仅依赖跨平台文件操作与 CLI 交互类库，无需原生编译环境。
- **支持平台**：Linux、Windows、macOS 均可稳定运行。

## 3. 使用方式 (Usage)

### 3.1. 直接同步 (Direct Sync)

通过提供源和目标工具的关键词，直接执行同步。

**命令格式:**
```bash
npx mcp-sync <source_keyword> <target_keyword>
```

**示例:**
将 `Codex` 的配置同步到 `Claude Code`。
```bash
npx mcp-sync codex claude
```
工具将根据下文定义的关键词 `codex` 和 `claude` 找到对应的配置文件并执行同步。如果源配置文件不存在，则会输出错误：`The source configuration file(<local file>) does not exist.`

### 3.2. 模式二：交互同步 (Interactive Sync)

当不带任何参数执行命令时，进入交互式问答模式。

**启动命令:**
```bash
npx mcp-sync
```

**操作流程:**

1. **选择源 (Select Source):**
    - 程序输出提示：`Select the configuration source file (选择源配置文件):`
    - 动态扫描并列出本地检测到的、受支持的工具配置文件作为选项。
    - **示例输出:**
        ```
        ? Select the configuration source file (选择源配置文件): (Use arrow keys)
        > 1. VS Code (~/.vscode/mcp.json)
          2. Cursor (~/.cursor/mcp.json)
          3. GitHub Copilot CLI (~/.copilot/mcp-config.json)
          4. Customize (手动输入路径)
        ```
    - 如果用户选择 `Customize`，则提示输入一个本地文件的绝对路径。程序接收路径后，会尝试将其与已知的配置文件特征进行匹配，以识别其所属的工具。

2. **选择目标 (Select Target):**
    - 程序输出提示：`Select the configuration target file (选择目标配置文件):`
    - 列表逻辑与第一步类似，列出本地检测到的配置文件。
    - **示例输出:**
        ```
        ? Select the configuration target file (选择目标配置文件): (Use arrow keys)
        > 1. VS Code (~/.vscode/mcp.json)
          2. Cursor (~/.cursor/mcp.json)
          3. GitHub Copilot CLI (~/.copilot/mcp-config.json)
          4. Customize (选择一个目标工具或创建新配置)
        ```
    - 如果用户选择 `Customize`，程序将列出 **所有本工具支持的** IDE 或 CLI 列表。用户选择其中一项后，如果对应的配置文件不存在，程序将根据预设路径自动创建该文件（包括目录）。

## 4. 模糊匹配关键词 (Fuzzy Matching Keywords)

为了提升用户体验，工具应支持下列关键词（不区分大小写）来匹配对应的工具。

| 工具名称 (Tool Name) | 支持的关键词 (Keywords) |
| :--- | :--- |
| Codex | `codex`, `openai`, `codex cli` |
| Claude Code | `claude`, `claude-code`, `claude code`, `anthropic` |
| Cursor | `cursor`, `cursor ide` |
| Gemini CLI | `gemini`, `gemini cli`, `google`, `gcloud` |
| GitHub Copilot CLI | `copilot`, `copilot cli`, `github`, `gh` |
| Visual Studio Code | `vscode`, `vs code`, `vs-code`, `code` |

## 5. 支持的工具与配置路径 (Supported Tools & Config Paths)

工具需要内置以下主流工具的默认配置文件路径，并能根据操作系统环境进行适配。因各个工具配置差异较大，执行跨工具转换时以 **Claude Code** 的结构作为中转基准。

| 工具名称 | Linux / macOS 路径 | Windows 路径 | 文档地址 |
| :--- | :--- | :--- | :--- |
| **Codex** | `~/.codex/config.toml` | `%USERPROFILE%\.codex\config.toml` | [Codex configuration](https://github.com/openai/codex/blob/main/docs/config.md) |
| **Claude Code** | `~/.claude.json` | `%USERPROFILE%\.claude.json` | [Claude Code MCP guide](https://docs.anthropic.com/en/docs/claude-code) |
| **Cursor** | `~/.cursor/mcp.json` | `%APPDATA%\Cursor\mcp.json` | [Cursor MCP guide](https://docs.cursor.com/context/mcp) |
| **Gemini CLI (gcloud)** | `~/.gemini/settings.json` | `%APPDATA%\.gemini\settings.json` | [Gemini CLI MCP server](https://github.com/google-gemini/gemini-cli/blob/main/docs/tools/mcp-server.md) |
| **GitHub Copilot CLI** | `~/.copilot/mcp-config.json` | `%USERPROFILE%\.copilot\mcp-config.json` | [Copilot CLI MCP usage](https://github.com/github/docs/blob/main/content/copilot/how-tos/use-copilot-agents/use-copilot-cli.md) |
| **Visual Studio Code** | `~/.vscode/mcp.json` | `%APPDATA%\Roaming\Code\User\mcp.json` | [VS Code MCP servers](https://code.visualstudio.com/docs/copilot/copilot-customization/copilot/chat/mcp-servers) |

*注：实现时应使用 Node.js 的 `os.homedir()` 与 `process.env.APPDATA` 获取用户主目录与 AppData 路径，并结合 `path.join()`/`path.resolve()` 组装，避免硬编码路径分隔符。*


### 5.1. Codex

- **默认配置文件**：`~/.codex/config.toml`

```toml
# ~/.codex/config.toml
[mcp_servers.context7]
command ="cmd"
args = [
    "/c", "npx", "-y",
    "@upstash/context7-mcp",
    "--api-key="YOUR_API_KEY",
    "--stdio"
]
env = { SystemRoot="C:\\Windows", PROGRAMFILES="C:\\Program Files" }
startup_timeout_ms = 60_000
```

### 5.2. Claude Code

- **默认配置文件**：`~/.claude.json`

```json
{
  "mcpServers": {
    "context7": {
        "type": "stdio",
        "command": "npx",
        "args": [
            "-y",
            "@upstash/context7-mcp",
            "--api-key",
            "ctx7sk-9f1af754-27ab-404f-803b-de38c8791284"
        ],
        "env": {}
    }
  }
}
```

### 5.3. Cursor

- **默认配置文件**：`~/.cursor/mcp.json`
- **配置示例（摘自官方文档）**：

```json
{
    "mcpServers": {
        "context7": {
            "command": "npx",
            "args": ["-y", "@upstash/context7-mcp", "--api-key", "YOUR_API_KEY"]
        }
    }
}
```

### 5.4. Gemini CLI (gcloud)

- **默认配置文件**：`~/.gemini/settings.json`
- **配置示例（摘自官方文档）**：

```json
{
    "mcpServers": {
        "context7": {
            "command": "npx",
            "args": ["-y", "@upstash/context7-mcp", "--api-key", "YOUR_API_KEY"]
        }
    }
}
```

### 5.5. GitHub Copilot CLI

- **默认配置文件**：`~/.copilot/mcp-config.json`
- **配置示例（摘自官方文档）**：

```json
{
  "mcpServers": {
        "docs": {
            "command": "npx",
            "args": ["-y", "@upstash/context7-mcp", "--api-key", "YOUR_API_KEY"]
        }
  }
}
```

### 5.6. Visual Studio Code

- **默认配置文件**：`~/.vscode/mcp.json`
- **配置示例（摘自官方文档）**：

```json
{
    "servers": {
        "context7": {
            "command": "npx",
            "args": ["-y", "@upstash/context7-mcp", "--api-key", "YOUR_API_KEY"]
        }
    }
}
```

## 6. 核心功能 (Core Features)

- **双模式操作**：支持快速直接的单行命令同步，以及引导式的交互问答同步。
- **模糊参数匹配**：用户无需记住工具的精确名称，工具会自动匹配常用关键词。
- **跨平台兼容**：完美支持 Linux、Windows 和 macOS 环境，自动处理不同操作系统的路径格式。
- **自动路径检测**：内置主流开发工具的默认配置路径，能自动发现本地存在的配置文件。
- **安全备份机制**：在执行任何覆盖操作前，自动备份目标配置文件，确保操作可逆，防止意外损坏。
- **自定义与扩展**：支持用户手动指定配置文件路径，并能在目标配置文件不存在时自动创建。



## 7. 文件备份机制 (Backup Mechanism)

安全是本工具的核心原则之一。在任何同步操作（即覆盖目标文件）发生 **之前**，必须执行以下备份流程：

1. **安全原则**：任何同步写入目标文件的操作前，必须完成备份，确保操作可逆。
2. **默认位置**：在用户主目录下创建 `~/.mcp-sync/backup/` 目录，若不存在则自动建立。
3. **备份内容**：完整复制 **当前的目标文件**。
4. **备份路径**：
    - 根目录：`~/.mcp-sync/backup/`
    - 子目录结构：`/<timestamp>/<original_directory_structure>/<original_filename>`
    - `<timestamp>`：执行同步操作时的 Unix 时间戳（毫秒），例如 `1677619200000`
5. **示例**：
    - **操作**：`npx mcp-sync vscode cursor`
    - **时间**：`2025-10-24 18:00:00`（假设时间戳 `1761319200000`）
    - **目标文件**：Linux 上为 `~/.cursor/mcp.json`
    - **执行动作**：程序将 `~/.cursor/mcp.json` 复制到 `~/.mcp-sync/backup/1761319200000/.cursor/mcp.json`
    - 这样既能防止备份文件被覆盖，又能完整保留原始文件的路径结构，便于查找和恢复。

## 8. 平台兼容性 (Platform Compatibility)

- **操作系统**：必须在主流的 Linux 发行版（Ubuntu、CentOS 等）以及 Windows 10/11、macOS 系统上稳定运行。
- **路径处理**：内部逻辑必须使用 Node.js `path` 模块中的 `path.join()`、`path.resolve()` 来处理文件路径，禁止硬编码 `/` 或 `\`。

---
